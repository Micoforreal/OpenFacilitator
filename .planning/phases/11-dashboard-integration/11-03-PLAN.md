---
phase: 11-dashboard-integration
plan: 03
type: execute
wave: 2
depends_on: ["11-01"]
files_modified:
  - apps/dashboard/src/components/rewards/progress-tab.tsx
  - apps/dashboard/src/components/rewards/addresses-tab.tsx
  - apps/dashboard/src/components/rewards/history-tab.tsx
  - apps/dashboard/src/components/rewards/rewards-dashboard.tsx
autonomous: true

must_haves:
  truths:
    - "Progress tab displays campaign progress, claim button, and reward estimate"
    - "Addresses tab displays address list with add/remove/verify functionality"
    - "History tab displays combined claim history and campaign history"
    - "Each tab shows appropriate empty states when no data"
  artifacts:
    - path: "apps/dashboard/src/components/rewards/progress-tab.tsx"
      provides: "Progress tab content wrapping ProgressDashboard"
      exports: ["ProgressTab"]
      min_lines: 40
    - path: "apps/dashboard/src/components/rewards/addresses-tab.tsx"
      provides: "Addresses tab content wrapping AddressList"
      exports: ["AddressesTab"]
      min_lines: 30
    - path: "apps/dashboard/src/components/rewards/history-tab.tsx"
      provides: "History tab combining ClaimHistory and CampaignHistory"
      exports: ["HistoryTab"]
      min_lines: 40
    - path: "apps/dashboard/src/components/rewards/rewards-dashboard.tsx"
      provides: "Dashboard importing and rendering tab components"
      contains: "ProgressTab"
  key_links:
    - from: "progress-tab.tsx"
      to: "progress-dashboard.tsx"
      via: "direct component usage"
      pattern: "ProgressDashboard"
    - from: "addresses-tab.tsx"
      to: "address-list.tsx"
      via: "direct component usage"
      pattern: "AddressList"
    - from: "history-tab.tsx"
      to: "claim-history.tsx"
      via: "direct component usage"
      pattern: "ClaimHistory"
    - from: "rewards-dashboard.tsx"
      to: "tab components"
      via: "TabsContent children"
      pattern: "ProgressTab|AddressesTab|HistoryTab"
---

<objective>
Create the three tab content components (Progress, Addresses, History) and wire them into the RewardsDashboard container.

Purpose: Organize existing rewards functionality into a clean tabbed interface with proper data fetching per tab.
Output: ProgressTab, AddressesTab, HistoryTab components integrated into RewardsDashboard.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-dashboard-integration/11-CONTEXT.md
@.planning/phases/11-dashboard-integration/11-RESEARCH.md
@.planning/phases/11-dashboard-integration/11-01-SUMMARY.md

# Existing components to wrap
@apps/dashboard/src/components/rewards/progress-dashboard.tsx
@apps/dashboard/src/components/rewards/address-list.tsx
@apps/dashboard/src/components/rewards/claim-history.tsx
@apps/dashboard/src/components/campaigns/campaign-history.tsx
@apps/dashboard/src/components/rewards/enrollment-modal.tsx

# Dashboard to update
@apps/dashboard/src/components/rewards/rewards-dashboard.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ProgressTab component</name>
  <files>apps/dashboard/src/components/rewards/progress-tab.tsx</files>
  <action>
Create ProgressTab that fetches campaign data and renders ProgressDashboard.

Data fetching (using react-query):
- activeCampaign: api.getActiveCampaign()
- volumeData: api.getRewardsVolume(campaignId) - enabled when campaign exists
- breakdownData: api.getVolumeBreakdown(campaignId) - enabled when campaign exists
- claimData: api.getMyClaim(campaignId) - enabled when campaign exists

Use useQueryClient for invalidation after claim success.

Render:
1. If loading: Loader2 spinner centered
2. If no active campaign: Card with Trophy icon, "No Active Campaign" message
3. If campaign exists: ProgressDashboard with all props:
   - campaign={activeCampaign.campaign}
   - userVolume={volumeData?.totalVolume ?? '0'}
   - totalPoolVolume={activeCampaign.totalVolume}
   - isFacilitatorOwner (from useAuth)
   - volumeBreakdown={breakdownData ?? null}
   - claim={claimData?.claim ?? null}
   - onClaimSuccess (invalidates queries)

Get isFacilitatorOwner from useAuth().
  </action>
  <verify>Tab shows campaign progress or empty state. Claim button works. Data refreshes on claim success.</verify>
  <done>ProgressTab displays campaign progress with all existing functionality</done>
</task>

<task type="auto">
  <name>Task 2: Create AddressesTab component</name>
  <files>apps/dashboard/src/components/rewards/addresses-tab.tsx</files>
  <action>
Create AddressesTab that manages address list and enrollment modal.

State:
- enrollmentModalOpen: boolean for enrollment modal
- Get addresses from useAuth() - rewardsStatus.addresses (need to expose this)

Actually, addresses aren't exposed in current useAuth. Options:
1. Add addresses to auth context
2. Fetch addresses in this component

Approach: Fetch using api.getRewardsStatus() with react-query, key: ['rewardsStatus'].

Data fetching:
- rewardsStatus: api.getRewardsStatus()

Render:
1. If loading: Loader2 spinner
2. AddressList component with:
   - addresses={rewardsStatus?.addresses ?? []}
   - onAddAddress={() => setEnrollmentModalOpen(true)}
   - onAddressRemoved={() => refetch rewardsStatus}
   - onVerify={() => setEnrollmentModalOpen(true)}

3. EnrollmentModal:
   - open={enrollmentModalOpen}
   - onOpenChange={setEnrollmentModalOpen}
   - On success, refetch rewardsStatus

Use refetchRewardsStatus from useAuth() after modal closes to update enrollment state.
  </action>
  <verify>Tab shows address list. Add button opens enrollment modal. Remove works. Verify works.</verify>
  <done>AddressesTab displays address management with add/remove/verify functionality</done>
</task>

<task type="auto">
  <name>Task 3: Create HistoryTab and wire up RewardsDashboard</name>
  <files>apps/dashboard/src/components/rewards/history-tab.tsx, apps/dashboard/src/components/rewards/rewards-dashboard.tsx</files>
  <action>
Part A: Create HistoryTab combining claim and campaign history.

Data fetching:
- claimHistory: api.getClaimHistory()
- campaignHistory: api.getCampaignHistory()

Render:
1. If both loading: Loader2 spinner
2. Claims section (show first per user decision - claim history above campaign history):
   - If claimHistory has claims: "Your Claims" header + ClaimHistory component
   - If no claims: skip section (don't show empty header)
3. Campaign History section:
   - "Campaign History" header
   - If loading campaignHistory: show spinner
   - If data: CampaignHistory component
   - If empty: Empty state message "No campaigns yet"

Part B: Update RewardsDashboard to use tab components.

Replace placeholder tab contents:
- TabsContent value="progress": <ProgressTab />
- TabsContent value="addresses": <AddressesTab />
- TabsContent value="history": <HistoryTab />

Import all three tab components at top of file.
  </action>
  <verify>History tab shows claim history above campaign history. RewardsDashboard shows real content in all tabs.</verify>
  <done>HistoryTab displays combined history, RewardsDashboard fully functional with all tabs</done>
</task>

</tasks>

<verification>
1. `npm run build` succeeds
2. Progress tab: Shows campaign progress, claim button when eligible, handles no-campaign state
3. Addresses tab: Shows address list, add/remove/verify all work, enrollment modal works
4. History tab: Shows claims first, then campaigns, handles empty states
5. Tab switching preserves data (no unnecessary refetches)
6. Query invalidation works after claim/address changes
</verification>

<success_criteria>
- All three tabs display correct content
- Existing ProgressDashboard, AddressList, ClaimHistory, CampaignHistory functionality preserved
- Empty states handled gracefully
- Data fetching efficient (no duplicate calls)
- Modal flows work correctly
</success_criteria>

<output>
After completion, create `.planning/phases/11-dashboard-integration/11-03-SUMMARY.md`
</output>
