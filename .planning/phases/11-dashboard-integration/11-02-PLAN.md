---
phase: 11-dashboard-integration
plan: 02
type: execute
wave: 2
depends_on: ["11-01"]
files_modified:
  - apps/dashboard/src/components/rewards/landing-page.tsx
  - apps/dashboard/src/components/rewards/rewards-dashboard.tsx
  - apps/dashboard/src/app/rewards/page.tsx
autonomous: true

must_haves:
  truths:
    - "Non-enrolled user sees landing page explaining rewards program"
    - "Enrolled user sees tabbed dashboard (Progress, Addresses, History)"
    - "Landing page has Get Started button that opens enrollment modal"
    - "Tab state persists in URL for shareable links"
  artifacts:
    - path: "apps/dashboard/src/components/rewards/landing-page.tsx"
      provides: "Landing page for non-enrolled users"
      exports: ["RewardsLandingPage"]
      min_lines: 50
    - path: "apps/dashboard/src/components/rewards/rewards-dashboard.tsx"
      provides: "Tabbed dashboard container for enrolled users"
      exports: ["RewardsDashboard"]
      contains: "TabsList"
    - path: "apps/dashboard/src/app/rewards/page.tsx"
      provides: "Page routing between landing and dashboard"
      contains: "isEnrolled"
  key_links:
    - from: "rewards/page.tsx"
      to: "auth-provider.tsx"
      via: "useAuth().isEnrolled"
      pattern: "isEnrolled"
    - from: "landing-page.tsx"
      to: "enrollment-modal.tsx"
      via: "onEnroll callback opens modal"
      pattern: "onEnroll"
    - from: "rewards-dashboard.tsx"
      to: "URL query param"
      via: "useSearchParams + router.push"
      pattern: "tab="
---

<objective>
Create landing page for non-enrolled users and tabbed dashboard container for enrolled users. Modify rewards page to route between them.

Purpose: Provide clear onboarding path for new users and organized dashboard experience for enrolled users.
Output: RewardsLandingPage, RewardsDashboard components, updated page.tsx routing logic.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-dashboard-integration/11-CONTEXT.md
@.planning/phases/11-dashboard-integration/11-RESEARCH.md
@.planning/phases/11-dashboard-integration/11-01-SUMMARY.md

# Existing components to reference
@apps/dashboard/src/app/rewards/page.tsx
@apps/dashboard/src/components/rewards/enrollment-modal.tsx
@apps/dashboard/src/components/rewards/progress-bar.tsx
@apps/dashboard/src/components/ui/tabs.tsx
@apps/dashboard/src/components/ui/collapsible.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create RewardsLandingPage component</name>
  <files>apps/dashboard/src/components/rewards/landing-page.tsx</files>
  <action>
Create landing page for non-enrolled users. Professional/clean tone per user decision.

Props:
- onEnroll: () => void - callback when user clicks Get Started

Structure:
1. Header section:
   - Trophy icon (h-12 w-12 text-primary mx-auto mb-4)
   - Title: "Get Rewarded for Using OpenFacilitator" (text-3xl font-bold tracking-tight)
   - Subtitle: "Track your payment volume and earn $OPEN tokens." (text-muted-foreground mt-2)

2. Progress Preview Card (shows sample progress bar per user decision):
   - Card with "Your Reward Journey" header
   - ProgressBar component with sample values (current="500000000" threshold="1000000000")
   - Caption: "Example: $500 of $1,000 threshold" (text-xs text-muted-foreground)

3. Expandable How-it-works section (using Collapsible):
   - CollapsibleTrigger: "How are rewards calculated?" with ChevronDown icon
   - CollapsibleContent with:
     - Step list: 1. Register addresses, 2. Process payments, 3. Meet threshold, 4. Claim tokens
     - Multiplier mention: "Facilitator owners get 2x multiplier"
     - Pool share explanation: "Rewards are distributed proportionally based on your share of total volume"

4. Get Started button:
   - Full width, primary variant
   - onClick calls onEnroll prop

Styling: max-w-2xl mx-auto px-4 py-12, centered text for header
  </action>
  <verify>Component renders without errors. Trophy icon, progress preview, collapsible, and button all visible.</verify>
  <done>RewardsLandingPage displays program explanation with Get Started CTA</done>
</task>

<task type="auto">
  <name>Task 2: Create RewardsDashboard tabbed container</name>
  <files>apps/dashboard/src/components/rewards/rewards-dashboard.tsx</files>
  <action>
Create tabbed dashboard container for enrolled users. Uses URL query param for tab state.

Props:
- None (fetches own data)

Features:
1. URL-synced tab state:
   - Read tab from searchParams.get('tab') || 'progress'
   - On tab change, router.push(`/rewards?tab=${value}`, { scroll: false })

2. Tab structure (Tabs, TabsList, TabsTrigger, TabsContent from ui/tabs):
   - Three tabs: progress, addresses, history
   - Tab labels: "Progress", "Addresses", "History"

3. Header (above tabs):
   - Trophy icon + "Rewards" title (match existing page style)
   - Admin link to /rewards/admin if isAdmin (from useAuth)

4. Tab content placeholders (actual content added in Plan 03):
   - TabsContent value="progress": Placeholder div "Progress content"
   - TabsContent value="addresses": Placeholder div "Addresses content"
   - TabsContent value="history": Placeholder div "History content"

Mark as 'use client'. Import useSearchParams, useRouter from next/navigation.
  </action>
  <verify>Component renders 3 tabs. Clicking tabs updates URL. Refreshing page preserves tab state.</verify>
  <done>RewardsDashboard shows tabbed interface with URL-synced tab state</done>
</task>

<task type="auto">
  <name>Task 3: Update rewards page routing logic</name>
  <files>apps/dashboard/src/app/rewards/page.tsx</files>
  <action>
Refactor page.tsx to route between landing page and dashboard based on enrollment status.

Logic:
1. Get isEnrolled, isLoading from useAuth()
2. Manage enrollmentModalOpen state for landing page enrollment
3. If isLoading: show loading spinner (existing pattern)
4. If !isEnrolled: render RewardsLandingPage with onEnroll={() => setEnrollmentModalOpen(true)}
5. If isEnrolled: render RewardsDashboard

Remove all existing data fetching and dashboard content (moved to RewardsDashboard and tab components).

Keep:
- Navbar component
- Main wrapper styling

Add:
- EnrollmentModal with open/onOpenChange for landing page
- Import RewardsLandingPage and RewardsDashboard

On enrollment success (modal closes), enrollment status will update via refetchRewardsStatus which the modal already calls.
  </action>
  <verify>Non-enrolled user sees landing page. Enrolled user sees tabbed dashboard. Clicking Get Started opens enrollment modal.</verify>
  <done>Page correctly routes between landing page and dashboard based on enrollment status</done>
</task>

</tasks>

<verification>
1. `npm run build` succeeds
2. As non-enrolled user: landing page with Get Started button
3. Click Get Started: enrollment modal opens
4. As enrolled user: tabbed dashboard appears
5. Tab changes update URL (?tab=addresses, ?tab=history)
6. Direct URL access works (/rewards?tab=history shows history tab)
</verification>

<success_criteria>
- Non-enrolled users see professional landing page
- Get Started opens enrollment modal
- Enrolled users see tabbed dashboard
- Tab state synced with URL
- No layout shift between states
</success_criteria>

<output>
After completion, create `.planning/phases/11-dashboard-integration/11-02-SUMMARY.md`
</output>
